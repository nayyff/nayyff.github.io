<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Magnolias Payment gateway</title>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@7.12.15/dist/sweetalert2.all.min.js"></script>
  <style>
    .form-container {
      max-width: 500px;
      margin: auto;
      margin-top: 50px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      background-color: #fff;
    }

    .payment-info {
      display: none;
    }

    #contact_number {
      outline: 0;
    }

    #contact_number:valid {
      border-color: green;
    }

    #contact_number:focus:invalid {
      border-color: red;
    }

    #ticket-info {
      font-size: 25px;
    }
  </style>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js">
  </script>
  <script type="text/javascript">
    (function () {
      emailjs.init({
        // publicKey: "EXM1NtCxfimV6531g"
        publicKey: "r49817Evs2ewOgIcP",
      });
    })();
  </script>
  <script src="email.js"></script>
</head>

<body class="bg-light">
  <div class="container">
    <div class="form-container">
      <h4 class="text-center mb-4">Magnolias Payment </h4>
      <form id="submit-to-google-sheet">

        <div class="form-group">
          <label for="name">Name:</label>
          <input class="form-control" type="text" name="name" id="name" placeholder="Name" required />
        </div>

        <div class="form-group">
          <label for="email">Email:</label>
          <input class="form-control" type="email" name="email" id="email" placeholder="Email@gmail.com" required />
        </div>

        <div class="form-group">
          <label for="slip">Contact Number:</label>
          <input class="form-control" type="tel" name="contact_number" id="contact_number" required
            pattern="628[0-9]{9,}" title="Format: 628xxxxxxxxxxx" placeholder="628xxxxxxxxxxx" minlength="11"
            oninput="this.value=this.value.replace(/[^0-9]/g,'');" />
        </div>

        <div class="form-group">
          <label for="loc">Ticket Category:</label>

          <select class="form-control" name="Ticket-Category" id="Ticket-Category" required onchange="showTicketInfo();">
  <option value="" disabled selected hidden>Choose...</option>
  <option value="presale-1">Presale 1 (Couple Only)</option>
  <option value="presale-2">Presale 2 (Limited 100 Slots)</option>
  <option value="presale-3">Presale 3 (Limited 240 Slots)</option>
  <option value="onthespot">On The Spot</option>
</select>

          <div id="ticket-info">
            <p id="presale-1-info" style="display: none;">Harga tiket Rp300.000</p>
            <p id="presale-2-info" style="display: none;">Harga tiket Rp170.000</p>
            <p id="presale-3-info" style="display: none;">Harga tiket Rp180.000</p>
            <p id="onthespot-info" style="display: none;">Harga tiket Rp200.000</p>
          </div>
        </div>

        <div class="form-group">
          <label for="payment_method">Payment Method:</label>

          <select class="form-control" name="payment_method" id="payment_method" required onchange="showPaymentInfo();">
            <option value="" disabled selected hidden>Choose...</option>
            <option value="transfer">Transfer</option>
            <option value="qris">QRIS</option>
            <option value="cash">Cash</option>
          </select>

        </div>

        <div id="payment-info" class="payment-info">
          <div id="transfer-info" style="display: none;">
            <img src="Mandiri-logo.webp" alt="Bank Image" style="max-width: 50%; margin-top: 10px;">
            <h1>Bank Mandiri</h1><br>
            <h2>000232323</h2>
          </div>

          <div id="qris-info" style="display: none;">
            <img src="exmpl-qris.png" alt="QR Code" style="max-width: 100%; margin-top: 10px;" />
          </div>

          <div id="cash-info" style="display: none;">
            <p>Silakan bayar secara tunai di lokasi yang ditentukan.</p>
          </div>
        </div>

        <div id="proof-upload" class="form-group mt-2" style="display: none;">
          <label for="media" class="form-check-label">Upload proof of payment :</label>
          <input class="form-control-file" type="file" name="media" id="media" disabled required />
        </div>
        


        <div class="form-group form-check">
          <input class="form-check-input" type="checkbox" id="ex" required />
          <label class="form-check-label" for="ex" style="font-size: 15px;">Saya sudah mengisi semua form dan membayar
            serta mengupload bukti pembayaran dan paham dengan syarat dan aturan yang berlaku
          </label>
        </div>
        <button type="submit" class="btn btn-primary btn-block" onclick="sendmail()">
          Submit
        </button>
      </form>
    </div>
  </div>

  <script>
    const scriptURL =
      "https://script.google.com/macros/s/AKfycbwKYCRQlk9fbjX7jzaO5hY9zzd3R1R2c6NvLV8XOvEqCXRubRe26VZVVvd-EL68S2xn/exec";
    const form = document.forms["submit-to-google-sheet"];
    const fileInput = document.getElementById("media");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(form);

      // Handle the file upload
      if (!fileInput.disabled && fileInput.files.length > 0) {
        const file = fileInput.files[0];
        const reader = new FileReader();

        // Size validation here, only less than 2MB allowed
        if (file.size > 1024 * 1024 * 2) {
          swal("Error", "File size should be less than 2MB.", "error");
          return;
        }

        reader.onload = async function () {
          formData.append("media", reader.result.split(",")[1]); // Append base64 data
          await submitForm(formData);
        };

        reader.readAsDataURL(file);
      } else {
        // Skip file upload if disabled or no file provided
        await submitForm(formData);
      }
    });

    async function submitForm(formData) {
      const submitButton = document.querySelector("button[type='submit']");
      submitButton.disabled = true;
      submitButton.innerText = "Loading...";

      fetch(scriptURL, { method: "POST", body: formData })
        .then((response) => {
          swal("Done", "Submitted Successfully, please check your email", "success");
          form.reset();
        })
        .catch((error) => {
          swal("Error", "Something went wrong. Please try again!", "error");
        })
        .finally(() => {
          submitButton.disabled = false;
          submitButton.innerText = "Submit";
        });
    }

    function showPaymentInfo() {
  const paymentMethod = document.getElementById("payment_method").value;
  const proofUpload = document.getElementById("proof-upload");
  const fileInput = document.getElementById("media");

  // Sembunyikan semua informasi pembayaran terlebih dahulu
  document.getElementById("transfer-info").style.display = "none";
  document.getElementById("qris-info").style.display = "none";
  document.getElementById("cash-info").style.display = "none";
  document.getElementById("payment-info").style.display = "none";

  // Tampilkan informasi metode pembayaran
  if (paymentMethod === "transfer") {
    document.getElementById("transfer-info").style.display = "block";
  } else if (paymentMethod === "qris") {
    document.getElementById("qris-info").style.display = "block";
  } else if (paymentMethod === "cash") {
    document.getElementById("cash-info").style.display = "block";
  }

  // Tampilkan container payment-info jika ada metode pembayaran yang dipilih
  if (paymentMethod) {
    document.getElementById("payment-info").style.display = "block";
  }

  // Atur elemen "Upload proof of payment" hanya jika metode pembayaran adalah transfer atau qris
  if (paymentMethod === "cash") {
    proofUpload.style.display = "none";
    fileInput.disabled = true; 
  } else if (paymentMethod === "transfer" || paymentMethod === "qris") {
    proofUpload.style.display = "block";
    fileInput.disabled = false; 
  }

  if (paymentMethod === "cash") {
    proofUpload.style.display = "none";
    fileInput.required = false; 
    fileInput.disabled = true;  
  } else if (paymentMethod === "transfer" || paymentMethod === "qris") {
    proofUpload.style.display = "block";
    fileInput.required = true;  
    fileInput.disabled = false; 
  }

}

function showTicketInfo() {
  const ticketCategory = document.getElementById("Ticket-Category").value;

  // Sembunyikan semua informasi tiket terlebih dahulu
  document.getElementById("presale-1-info").style.display = "none";
  document.getElementById("presale-2-info").style.display = "none";
  document.getElementById("presale-3-info").style.display = "none";
  document.getElementById("onthespot-info").style.display = "none";

  // Tampilkan informasi berdasarkan kategori tiket yang dipilih
  if (ticketCategory === "presale-1") {
    document.getElementById("presale-1-info").style.display = "block";
  } else if (ticketCategory === "presale-2") {
    document.getElementById("presale-2-info").style.display = "block";
  } else if (ticketCategory === "presale-3") {
    document.getElementById("presale-3-info").style.display = "block";
  } else if (ticketCategory === "onthespot") {
    document.getElementById("onthespot-info").style.display = "block";
  }
}

  </script>
</body>

</html>